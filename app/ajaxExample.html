<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dropdown Test</title>
    <style>
        .container {
            display: flex;
            /* Use flexbox for layout */
        }

        .table-container {
            flex: 1;
            /* Table container takes up remaining space */
            margin: 40px;
            /* Add some spacing between table and chart */
        }

        .chart-container {
            flex: 1;
            /* Chart container takes up remaining space */
            margin: 40px;
        }

        /* Style for table and chart */
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }

        canvas {
            border: 1px solid black;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@^3"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@^2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@^1"></script>

</head>

<body>
    <!-- create the dropdown to select the options -->
    <h1>Select Options</h1>

    <select id="view">
        <option value="">Select View</option>
        <option value="completeView">Complete View</option>
        <option value="yearView">Year View</option>
        <option value="monthView">Month View</option>
        <option value="weekView">Week View</option>
    </select>


    <select id="mode">
        <option value="">Select Mode</option>
        <option value="units">Units</option>
        <option value="revenue">Revenue</option>
    </select>


    <select id="year">
        <option value="">Select Year</option>
        <option value="2020">2020</option>
        <option value="2021">2021</option>
        <option value="2022">2022</option>
    </select>


    <select id="month">
        <option value="">Select Month</option>
        <!-- Generate month options from 1 to 12 -->
        <script>
            for (let i = 1; i <= 12; i++) {
                document.write('<option value="' + i + '">' + i + '</option>');
            }
        </script>
    </select>


    <select id="week">
        <option value="">Select Week</option>
        <!-- Generate week options from 1 to 52 -->
        <script>
            for (let i = 1; i <= 52; i++) {
                document.write('<option value="' + i + '">' + i + '</option>');
            }
        </script>
    </select>




    <div id="salesPerStorePerMonth" class="container">

        <div class="chart-container">
            <h3>Monthly Pizza Sales Data Per Store over the 3 years</h3>
            <div id="loading3" style="display: none;">Loading...</div> <!-- Loading indicator -->
            <canvas id="salesChartPerStorePerMonth" width="400" height="100"></canvas>
            <!-- The chart will be generated here by JavaScript -->
        </div>

    </div>


    <div id="salesPerStore" class="container">

        
        <div class="chart-container">

            <h3>Pizza Sales Data for selected timeframe </h3>
            <div id="loading" style="display: none;">Loading...</div> <!-- Loading indicator -->
            <canvas id="salesChart" width="400" height="200"></canvas>
            <!-- The chart will be generated here by JavaScript -->
        </div>

        
        <div class="chart-container">

            <h3>Pizza Sales Data Per Store for selected timeframe </h3>
            <div id="loading2" style="display: none;">Loading...</div> <!-- Loading indicator -->
            <canvas id="salesChartPerStore" width="400" height="200"></canvas>
            <!-- The chart will be generated here by JavaScript -->
        </div>


    </div>

    
    <div id="salesPerTime" class="container">
        <div id="tablePerTime" class="table-container">
            <!-- The table will be generated here by JavaScript -->
        </div>
        <div id="tablePerStore" class="table-container">
            <!-- The table will be generated here by JavaScript -->
        </div>
    </div>




    <script src="assets/js/displayJsonData.js"></script>

    <script>
        $(document).ready(function () {
            // Function to fetch and display data
            function fetchData() {
                var view = $('#view').val();
                var mode = $('#mode').val();
                var year = $('#year').val();
                var month = $('#month').val();
                var week = $('#week').val();

                // empty the table of previous value each time a dropdown gets changed
                $('#tablePerTime').empty();
                $('#tablePerStore').empty();

                // check view, show/hide relevant dropdowns and check if the relevant dropdown are set 
                var ready = false
                switch (view) {
                    case "completeView":
                        $('#year, #month, #week').hide()
                        if (mode) { ready = true };
                        break;
                    case "yearView":
                        $('#year').show()
                        $('#month, #week').hide()
                        if (mode && year) { ready = true };
                        break;
                    case "monthView":
                        $('#year, #month').show()
                        $('#week').hide()
                        if (mode && year && month) { ready = true };
                        break;
                    case "weekView":
                        $('#year, #week').show()
                        $('#month').hide()
                        if (mode && year && week) { ready = true };
                        break;
                }

                // if all the relevant data is set, the function continues to make ajax request
                if (ready) {
                    $('#loading').show(); // Show loading indicator for first table
                    // ajax request for the first data
                    $.ajax({
                        url: 'ajax/getSalesPerTimeframe.php',
                        type: 'POST',
                        data: {
                            view: view,
                            mode: mode,
                            year: year,
                            month: month,
                            week: week
                        },
                        success: function (response) {
                            if (response.success) {
                                // Call the functions from to display the table and the chart
                                displayJsonTable(response.data, "tablePerTime");

                                createBarChart(response.data, 'salesChart');
                            } else {
                                $('#salesPerTime').html('<p>' + response.message + '</p>');
                            }
                        },
                        error: function (xhr, status, error) {
                            console.log('AJAX Error:', status, error);
                        },
                        complete: function () {
                            $('#loading').hide(); // Hide loading indicator when request is complete
                        }
                    });

                    $('#loading2').show(); // Show loading indicator for second table 
                    // AJAX request for the second data
                    $.ajax({
                        url: 'ajax/getSalesPerStore.php',
                        type: 'POST',
                        data: {
                            view: view,
                            mode: mode,
                            year: year,
                            month: month,
                            week: week
                        },
                        success: function (response) {
                            if (response.success) {
                                // Call the function from showTable.js
                                displayJsonTable(response.data, "tablePerStore");

                                createBarChart(response.data, 'salesChartPerStore');
                            } else {
                                $('#salesPerStore').html('<p>' + response.message + '</p>');
                            }
                        },
                        error: function (xhr, status, error) {
                            console.log('AJAX Error:', status, error);
                        },
                        complete: function () {
                            $('#loading2').hide(); // Hide loading indicator when request is complete
                        }
                    });

                    $('#loading3').show(); // Show loading indicator for first table
                    // ajax request for the first data
                    $.ajax({
                        url: 'ajax/getSalesPerStorePerMonth.php',
                        type: 'POST',
                        data: {
                            view: view,
                            mode: mode,
                            year: year,
                            month: month,
                            week: week
                        },
                        success: function (response) {
                            if (response.success) {
                                // Call the functions from to display the table and the chart
                                createLineChart(response.data, 'salesChartPerStorePerMonth');
                            } else {
                                $('#salesPerStorePerMonth').html('<p>' + response.message + '</p>');
                            }
                        },
                        error: function (xhr, status, error) {
                            console.log('AJAX Error:', status, error);
                        },
                        complete: function () {
                            $('#loading3').hide(); // Hide loading indicator when request is complete
                        }
                    });
                }
            }

            // Trigger fetchData when any dropdown value changes
            $('#view, #mode, #year, #month, #week').change(fetchData);
        });
    </script>
</body>

</html>